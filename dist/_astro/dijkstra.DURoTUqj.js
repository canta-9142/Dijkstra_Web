import{p as q,j as J,U as s}from"./Utils.Dx5o_ao2.js";import{r as b}from"./index.Cd_vQiNd.js";const K=window.P5_CONFIG||{width:111,height:111},{width:R,height:A}=K,$=({containerId:N})=>{const k=b.useRef(null),V=b.useRef(null);return b.useEffect(()=>{const F=o=>{const n=Math.floor((R-1)/10),h=Math.floor((A-1)/10),r=[];let d="maze",u,S,c=null,f=null,g=null,U=!1;function _(){r.length=0;for(let i=0;i<n;i++){let a=[];for(let l=0;l<h;l++){let w=new s.Node(i*n+l);a.push(w)}r.push(a)}u=new s.Heap,S=new s.RandomHeap,c=null,f=null,g=null;let t=Math.floor(o.random(0,h-2)/2)*2+1,e=Math.floor(o.random(0,n-2)/2)*2+1;S.push(r[t][e])}function O(){for(let t=0;t<h;t++)for(let e=0;e<n;e++){const i=r[t][e];i.state!==s.Node.States.Blocked&&(i.state=s.Node.States.Undiscovered),i.prev=null,i.dist=Number.MAX_VALUE,i.est=Number.MAX_VALUE,i.parent=null,i.child=null,i.left=i,i.right=i,i.degree=0,i.mark=!1}u=new s.Heap,c=null,f=null,g=null,j()}function y(){_(),d="maze",console.log("phase: maze"),o.loop()}function z(){O(),d="placing",console.log("phase: placing"),o.loop()}function D(){if(!c||!f){z();return}c.state=s.Node.States.Discovered,c.dist=0,u.push(c),U=window.P5_CONFIG.useAStar??!1,d="search",console.log("phase: search")}function H(){let t=S.pop();if(t===null)return!1;let e=Math.floor(t.index/n),i=t.index%n;if(t.prev===null)t.state=s.Node.States.Undiscovered;else{let l=Math.floor((t.index+t.prev.index)/2);t.state=s.Node.States.Undiscovered,t.prev.state=s.Node.States.Undiscovered,r[Math.floor(l/n)][l%n].state=s.Node.States.Undiscovered}const a=[];e>=2&&a.push(r[e-2][i]),e<=h-3&&a.push(r[e+2][i]),i>=2&&a.push(r[e][i-2]),i<=n-3&&a.push(r[e][i+2]);for(let l=a.length-1;l>0;l--){const w=Math.floor(Math.random()*(l+1));[a[l],a[w]]=[a[w],a[l]]}for(const l of a)X(t,l);return S.n===0}function X(t,e){e.prev===null&&S.push(e),e.prev=t}function T(){let t=u.pop();if(t===null)return!1;let e=Math.floor(t.index/n),i=t.index%n;return t.state===s.Node.States.Visited||t.state===s.Node.States.Blocked?!1:(t.state=s.Node.States.Visited,t===f?!0:(U?(e!=0&&m(t,r[e-1][i],t.dist+1),e!=h-1&&m(t,r[e+1][i],t.dist+1),i!=0&&m(t,r[e][i-1],t.dist+1),i!=n-1&&m(t,r[e][i+1],t.dist+1)):(e!=0&&v(t,r[e-1][i],t.dist+1),e!=h-1&&v(t,r[e+1][i],t.dist+1),i!=0&&v(t,r[e][i-1],t.dist+1),i!=n-1&&v(t,r[e][i+1],t.dist+1)),!1))}function v(t,e,i){e.state===s.Node.States.Visited||e.state===s.Node.States.Blocked||(e.state!==s.Node.States.Discovered?(e.dist=i,e.prev=t,e.state=s.Node.States.Discovered,u.push(e)):u.prioritize(e,i)&&(e.prev=t))}function m(t,e,i){if(e.state===s.Node.States.Visited||e.state===s.Node.States.Blocked)return;const a=Y(e);e.state!==s.Node.States.Discovered?(e.dist=i,e.est=a,e.prev=t,e.state=s.Node.States.Discovered,u.push(e)):u.prioritize(e,i,a)&&(e.prev=t)}function Y(t){let e=Math.abs(t.index%n-f.index%n),i=Math.abs(t.index/n-f.index/n);return e+i}function j(){o.background(10);for(let t=0;t<h;t++)for(let e=0;e<n;e++){const i=r[t][e];if(i===c)o.fill(255,100,0);else if(i===f)o.fill(255,255,0);else switch(i.state){case s.Node.States.Undiscovered:o.fill(50,50,50);break;case s.Node.States.Discovered:o.fill(255,0,0);break;case s.Node.States.Visited:o.fill(0,255,0);break;case s.Node.States.Path:o.fill(0,0,255);break;case s.Node.States.Blocked:o.fill(180,130,80);break}o.rect(e*10+1,t*10+1,9,9)}}o.setup=()=>{o.createCanvas(R,A),_(),o.noLoop(),o.beginGenerating=y,o.beginPlacing=z},o.draw=()=>{if(j(),d==="maze"){if(H()){z();return}}else if(d!=="placing")if(d==="search"){if(u.n===0){o.print("何らかのエラーにより、目的地を見つけられませんでした。"),d="done";return}T()&&(d="path",console.log("phase: path"),g=f);return}else if(d==="path"){for(;g!=c&&g.prev!==null;)g.prev.state=s.Node.States.Path,g=g.prev;d="done",console.log("phase: done");return}else o.noLoop()},o.mousePressed=()=>{if(d!=="placing")return;const t=Math.floor(o.mouseY/10),e=Math.floor(o.mouseX/10);if(t<0||t>=h||e<0||e>=n)return;const i=r[t][e];i.state!=s.Node.States.Blocked&&(c?!f&&i!==c&&(f=i,D()):c=i)}},E=N?document.getElementById(N):k.current;if(!E)return;const p=new q(F,E);V.current=p,window.P5_INSTANCE=p;const M=()=>p.beginGenerating(),P=()=>p.beginPlacing(),G=o=>{const L=o.target.checked;window.P5_CONFIG={width:window.P5_CONFIG.width,height:window.P5_CONFIG.height,useAStar:L}},B=document.getElementById("btn-generate"),C=document.getElementById("btn-reset"),I=document.getElementById("astar-checkbox");return B?.addEventListener("click",M),C?.addEventListener("click",P),I?.addEventListener("change",G),()=>{B?.removeEventListener("click",M),C?.removeEventListener("click",P),I?.removeEventListener("change",G),p.remove(),delete window.P5_INSTANCE}},[N]),N?null:J.jsx("div",{ref:k})};export{$ as default};
